    <%@ page pageEncoding="UTF-8" %>
    <%@ taglib prefix="c" uri="jakarta.tags.core" %>
    <%@ taglib prefix="fn" uri="jakarta.tags.functions" %>

    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Onlineplay homepage</title>
        <link rel="stylesheet" href="./resources/css/home.css">
        <!-- For React -->
        <link rel="stylesheet" href="${react.css}">
    </head>

<body>
    <div class="container">
        <div class="half left">
            <p>
                    Sylvain's minimal version of the web application onlineplay.
                </p>
                <p>
                    <a href="registration">Sign up</a>
                    </br>
                    <a href="authentication">log in</a>
                    <c:if test="${sessionScope.userConnection.userId !=-1}">
                        </br>
                        <a href="logout">log out</a>
                    </c:if>
                    </br>
                    <a href="javascript:void(0);" id="sendDummyUser01">Launch fake-user_01</a>
                    <a href="javascript:void(1);" id="sendDummyUser02">Launch fake-user_02</a>
                    <a href="javascript:void(2);" id="sendDummyUser03">Launch fake-user_03</a>
                    </br>
                    <a href="https://caltuli.online/docs/index.html">Project site generated by maven-site-plugin</a>
                    </br>
                    <a href="https://github.com/workaholic-v-0-0-0/onlineplay">Project sources on GitHub</a>
                </p>

                <c:if test="${sessionScope.userConnection.userId != -1}">
                    <p>
                        You are authenticated as <c:out value="${sessionScope.user.username}" />
                        </br>
                        Your user'id is <c:out value="${sessionScope.userConnection.userId}" />
                    </p>
                </c:if>

                <div id="authenticatedUsersList">
                    <p>Authenticated users list:</p>
                    <ul>
                        <!-- Quand la page est chargée, les noms des utilisateurs authentifiés
                        sont récupérés dans le paramètre JSP authenticatedUsers -->
                        <c:forEach var="entry" items="${authenticatedUsers}">
                            <li
                                data-username="${entry.value.username}"
                                data-message="${entry.value.message}"
                                data-id="${entry.value.id}"
                            >
                                <c:out value="${entry.value.username} (id: ${entry.value.id}), message: ${entry.value.message})" />
                            </li>
                        </c:forEach>
                        <!-- Ensuite, cette liste sera mise à jour par JavaScript -->
                    </ul>
                </div>
                <div id="waitingToPlayUsersList">
                    <p>Users who want to play a game:</p>
                    <ul>
                        <!-- Quand la page est chargée, les noms des utilisateurs qui souhaitent
                        jouer une partie sont récupérés dans le paramètre JSP waitingToPlayUsers -->
                        <c:forEach var="entry" items="${waitingToPlayUsers}">
                            <li
                                data-username="${entry.value.username}"
                                data-message="${entry.value.message}"
                                data-id="${entry.value.id}"
                            >
                                <form action="home" method="post">
                                    <input type="hidden" name="action" value="play_with">
                                    <input type="hidden" name="user_id" value="${entry.value.id}">
                                    <input type="submit" value="Play with ${entry.value.username}"/>
                                </form>
                            </li>
                        </c:forEach>
                        <!-- Ensuite, les nom des utilisateurs qui souhaitent jouer une
                        partie seront ajoutés ici par JavaScript -->
                    </ul>
                </div>
                <div id="gamesList">
                    <p>Games:</p>
                    <ul>
                        <!-- Quand la page est chargée, les résumés des parties en cours sont
                        récupérés dans le paramètre JSP games -->
                        <c:forEach var="entry" items="${games}">
                            <li
                                data-id="${entry.value.id}"
                                data-firstPlayerUsername="${entry.value.firstPlayerUsername}"
                                data-secondPlayerUsername="${entry.value.secondPlayerUsername}"
                            >
                                <c:choose>
                                    <c:when test="${not empty entry.value.firstPlayerUsername}">
                                        <c:out value="${entry.value.firstPlayerUsername}" />
                                    </c:when>
                                    <c:otherwise>
                                        <c:out value="#nobody#" />
                                    </c:otherwise>
                                </c:choose>
                                " vs "
                                <c:choose>
                                    <c:when test="${not empty entry.value.secondPlayerUsername}">
                                        <c:out value="${entry.value.secondPlayerUsername}" />
                                    </c:when>
                                    <c:otherwise>
                                        <c:out value="#nobody#" />
                                    </c:otherwise>
                                </c:choose>
                            </li>
                        </c:forEach>
                        <!-- Ensuite, cette liste sera mise à jour par JavaScript -->
                    </ul>
                </div>

                <script src="resources/js/updateLists.js"></script>
                <script src="resources/js/fakeUsersManagement.js"></script>

                <!-- To make the client able to propose a new game -->
                <form action="home" method="post">
                    <input type="hidden" name="action" value="new_game">
                    <input type="submit" value="New game"/>
                </form>
        </div>
        <div class="half right">
                <!-- For React -->
                    <div id="root"></div>

                    <script type="text/javascript">
                      var game = '${game}';
                      var gameId = '${fn:escapeXml(gameId)}';
                      var playerId = '${fn:escapeXml(playerId)}';
                    </script>

                    <!-- React scripts -->
                    <script src="${react.chunk.js}"></script>
                    <script src="${react.js}"></script>
        </div>
    </div>

</body>
</html>
